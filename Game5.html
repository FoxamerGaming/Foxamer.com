<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Arcane Wilds VR - Enhanced Graphics</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <style>
      #ui {
        position: fixed;
        top: 12px;
        left: 12px;
        color: #fff;
        background: rgba(30,30,30,0.7);
        padding: 10px 16px;
        border-radius: 8px;
        font-family: Arial, sans-serif;
        z-index: 10;
        min-width: 220px;
      }
      #ui h3 { margin: 0 0 6px 0; }
      #ui ul { padding-left: 20px; margin: 0; }
      #ui small { color: #ccc; font-size: 12px; }
      #missions {
        margin-top: 10px;
        background: rgba(0,0,0,0.3);
        padding: 8px;
        border-radius: 6px;
      }
      #missions b {
        color: #9cf;
      }
    </style>
  </head>
  <body>
    <div id="ui">
      <h3>Arcane Wilds VR</h3>
      <b>Health:</b> <span id="health">100</span><br>
      <b>Hunger:</b> <span id="hunger">100</span><br>
      <b>Thirst:</b> <span id="thirst">100</span><br>
      <b>Inventory:</b>
      <ul id="invList"><li>Herb (demo)</li></ul>
      <div id="missions">
        <b>Mission:</b>
        <div id="missionText"></div>
        <div id="missionStatus"></div>
      </div>
      <small>
        Move: WASD / VR Joystick<br>
        Jump: Space / A Button<br>
        Cast Fireball: Click / Trigger<br>
        Pick up: Walk into objects
      </small>
    </div>
    <a-scene
      environment="preset: forest; skyType: atmosphere; lighting: distant; groundTexture: walk; ground: hills; dressing: trees, rocks, mushrooms, grass, flowers; dressingAmount: 48; fog: 0.8"
      shadow="type: pcfsoft"
      renderer="colorManagement: true; physicallyCorrectLights: true; shadowMapType: pcfsoft; pixelRatio: 2"
      vr-mode-ui="enabled: true"
      embedded>
      <!-- High-res Skybox -->
      <a-assets>
        <img id="skyTexture" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg">
        <!-- Realistic trees and rocks -->
        <a-asset-item id="treeModel" src="https://cdn.aframe.io/test-models/models/tree/scene.gltf"></a-asset-item>
        <a-asset-item id="rockModel" src="https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/Rock/glTF/Rock.gltf"></a-asset-item>
        <a-asset-item id="mushroomModel" src="https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/Mushroom/glTF/Mushroom.gltf"></a-asset-item>
        <a-asset-item id="stoneModel" src="https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/Stone/glTF/Stone.gltf"></a-asset-item>
      </a-assets>
      <a-sky src="#skyTexture" rotation="0 -90 0"></a-sky>
      <!-- Extra detailed environment -->
      <a-entity gltf-model="#treeModel" scale="1.2 1.2 1.2" position="5 0 -12"></a-entity>
      <a-entity gltf-model="#treeModel" scale="1.3 1.3 1.3" position="-7 0 -14"></a-entity>
      <a-entity gltf-model="#treeModel" scale="1.1 1.1 1.1" position="10 0 -12"></a-entity>
      <a-entity gltf-model="#rockModel" scale="0.8 0.8 0.8" position="2 0 -4"></a-entity>
      <a-entity gltf-model="#rockModel" scale="0.6 0.6 0.6" position="-2 0 -7"></a-entity>
      <a-entity gltf-model="#mushroomModel" scale="0.3 0.3 0.3" position="1 0 -1.2"></a-entity>
      <a-entity gltf-model="#mushroomModel" scale="0.4 0.4 0.4" position="3 0 -2.5"></a-entity>
      <a-entity gltf-model="#mushroomModel" scale="0.2 0.2 0.2" position="-3 0 -3"></a-entity>
      <!-- Pickable Stone for mission -->
      <a-entity id="stone" gltf-model="#stoneModel" scale="0.5 0.5 0.5" position="0 0.5 -3" class="pickup"></a-entity>
      <!-- PLAYER RIG (First Person) -->
      <a-entity id="rig" movement-controls="fly: false; speed: 0.18"
                position="0 1.6 7"
                wasd-controls="acceleration: 45">
        <a-entity id="playercam" camera
                  look-controls="pointerLockEnabled: true; touchEnabled: true"
                  position="0 0 0"
                  wasd-controls
                  ></a-entity>
        <a-entity laser-controls="hand: right"></a-entity>
        <a-entity hand-controls="hand: left"></a-entity>
        <a-entity hand-controls="hand: right"></a-entity>
      </a-entity>
      <!-- FIREBALL TEMPLATE -->
      <a-entity id="fireball-template" geometry="primitive: sphere; radius: 0.13"
        material="color: orange; emissive: #ff8800; metalness: 0.35; roughness: 0.3"
        visible="false"></a-entity>
      <!-- LIGHTS -->
      <a-entity light="type: directional; castShadow: true; intensity: 1.3; shadowCameraTop: 10; shadowCameraBottom: -10; shadowCameraLeft: -10; shadowCameraRight: 10" position="2 8 2"></a-entity>
      <a-entity light="type: ambient; intensity: 0.5"></a-entity>
    </a-scene>
    <script>
      // Survival and inventory system
      let stats = { health: 100, hunger: 100, thirst: 100 };
      let inventory = ['Herb (demo)'];
      let lastUpdate = performance.now();

      function updateUI() {
        document.getElementById('health').textContent = Math.round(stats.health);
        document.getElementById('hunger').textContent = Math.round(stats.hunger);
        document.getElementById('thirst').textContent = Math.round(stats.thirst);
        const invList = document.getElementById('invList');
        invList.innerHTML = '';
        inventory.forEach(item => {
          const li = document.createElement('li');
          li.textContent = item;
          invList.appendChild(li);
        });
      }
      updateUI();

      // Survival stats decrease over time
      function statsLoop() {
        let now = performance.now();
        let dt = (now - lastUpdate)/1000;
        lastUpdate = now;
        stats.hunger -= dt * 0.5;
        stats.thirst -= dt * 0.8;
        if (stats.hunger <= 0 || stats.thirst <= 0) stats.health -= dt * 2.5;
        stats.hunger = Math.max(0, Math.min(100, stats.hunger));
        stats.thirst = Math.max(0, Math.min(100, stats.thirst));
        stats.health = Math.max(0, Math.min(100, stats.health));
        updateUI();
        requestAnimationFrame(statsLoop);
      }
      statsLoop();

      // Fireball magic system (click/tap or VR trigger)
      const scene = document.querySelector('a-scene');
      const rig = document.querySelector('#rig');
      const fireballTemplate = document.querySelector('#fireball-template');
      function shootFireball() {
        // Clone fireball at camera position
        const cam = rig.querySelector('[camera]');
        const camWorldPos = new THREE.Vector3();
        cam.object3D.getWorldPosition(camWorldPos);
        const dir = new THREE.Vector3();
        cam.object3D.getWorldDirection(dir);
        let fb = fireballTemplate.cloneNode();
        fb.setAttribute('visible', 'true');
        fb.setAttribute('position',
          `${camWorldPos.x + dir.x*0.5} ${camWorldPos.y} ${camWorldPos.z + dir.z*0.5}`);
        fb.setAttribute('dynamic-body', 'mass:0.1');
        scene.appendChild(fb);
        // Launch it forward
        setTimeout(() => {
          if (fb.body) {
            fb.body.velocity.set(dir.x*9, dir.y*9, dir.z*9);
          }
        }, 80);
        // Remove after 2 seconds
        setTimeout(() => { if (fb.parentNode) fb.parentNode.removeChild(fb); }, 2000);
      }

      // Mouse click (desktop) or trigger (VR)
      window.addEventListener('mousedown', (e) => { shootFireball(); });
      scene.addEventListener('triggerdown', (e) => { shootFireball(); });

      // Missions System
      const missions = [
        {
          text: "Find and collect the magic stone.",
          objective: () => inventory.includes("Magic Stone"),
          complete: false,
          reward: () => { stats.health = Math.min(100, stats.health + 20); }
        },
        {
          text: "Cast a fireball spell.",
          objective: () => window.fireballCastCount > 0,
          complete: false,
          reward: () => { stats.hunger = Math.min(100, stats.hunger + 15); }
        }
      ];
      let currentMission = 0;
      let missionText = document.getElementById('missionText');
      let missionStatus = document.getElementById('missionStatus');
      missionText.textContent = missions[0].text;
      missionStatus.textContent = "";

      function advanceMission() {
        if (currentMission < missions.length - 1) {
          currentMission++;
          missionText.textContent = missions[currentMission].text;
          missionStatus.textContent = "";
        } else {
          missionText.textContent = "All missions complete!";
          missionStatus.textContent = "You are a true survivor!";
        }
      }

      // Inventory and Pickup
      // For demo, stone is "Magic Stone" for mission
      scene.addEventListener('loaded', function() {
        const stone = document.getElementById('stone');
        function checkPickup() {
          const rigPos = new THREE.Vector3();
          rig.object3D.getWorldPosition(rigPos);
          const stonePos = new THREE.Vector3();
          stone.object3D.getWorldPosition(stonePos);
          const dist = rigPos.distanceTo(stonePos);
          if (dist < 0.9 && stone.getAttribute('visible')) {
            inventory.push('Magic Stone');
            updateUI();
            stone.setAttribute('visible', false);
            // Mission check
            if (missions[0] && !missions[0].complete && missions[0].objective()) {
              missions[0].complete = true;
              missions[0].reward();
              missionStatus.textContent = "Mission complete! (Health +20)";
              setTimeout(advanceMission, 2200);
            }
          }
          requestAnimationFrame(checkPickup);
        }
        checkPickup();
      });

      // Fireball mission tracking
      window.fireballCastCount = 0;
      function fireballProgress() {
        if (missions[1] && !missions[1].complete && missions[1].objective()) {
          missions[1].complete = true;
          missions[1].reward();
          missionStatus.textContent = "Mission complete! (Hunger +15)";
          setTimeout(advanceMission, 2200);
        }
      }
      // Hook fireball counter
      (function(){
        const origShoot = shootFireball;
        window.shootFireball = function(){
          window.fireballCastCount++;
          fireballProgress();
          origShoot();
        }
      })();

    </script>
  </body>
</html>